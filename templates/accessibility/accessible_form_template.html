<!--
    Accessible Form Template
    WCAG 2.1 AA Compliant

    Features:
    - Explicit label associations
    - Fieldset/legend for grouped controls
    - ARIA attributes for error states
    - Required field indicators (visual + programmatic)
    - Error messages linked to inputs
    - Clear focus indicators
-->

<form id="{{FORM_ID}}" action="{{FORM_ACTION}}" method="post" novalidate>
    <!-- Form Title -->
    <h2 id="form-title">{{FORM_TITLE}}</h2>
    <p id="form-instructions">
        Fields marked with <span aria-hidden="true">*</span>
        <span class="sr-only">asterisk</span> are required.
    </p>

    <!-- Text Input -->
    <div class="form-group">
        <label for="full-name">
            Full Name <span class="text-danger" aria-hidden="true">*</span>
        </label>
        <input type="text"
               class="form-control"
               id="full-name"
               name="full_name"
               required
               aria-required="true"
               aria-describedby="name-help"
               autocomplete="name">
        <small id="name-help" class="form-text text-muted">
            Enter your first and last name as they appear on official documents.
        </small>
    </div>

    <!-- Email Input with Error State Example -->
    <div class="form-group">
        <label for="email">
            Email Address <span class="text-danger" aria-hidden="true">*</span>
        </label>
        <input type="email"
               class="form-control"
               id="email"
               name="email"
               required
               aria-required="true"
               aria-describedby="email-help email-error"
               aria-invalid="false"
               autocomplete="email">
        <small id="email-help" class="form-text text-muted">
            We'll use this email for course communications.
        </small>
        <!-- Error message (hidden by default, shown on validation error) -->
        <div id="email-error" class="invalid-feedback" role="alert">
            Please enter a valid email address (e.g., student@example.edu).
        </div>
    </div>

    <!-- Select Dropdown -->
    <div class="form-group">
        <label for="course-section">Course Section</label>
        <select class="form-control"
                id="course-section"
                name="course_section"
                aria-describedby="section-help">
            <option value="">-- Select a section --</option>
            <option value="section-a">Section A: Monday/Wednesday 9:00 AM</option>
            <option value="section-b">Section B: Tuesday/Thursday 2:00 PM</option>
            <option value="section-c">Section C: Online Asynchronous</option>
        </select>
        <small id="section-help" class="form-text text-muted">
            Choose the section that best fits your schedule.
        </small>
    </div>

    <!-- Textarea -->
    <div class="form-group">
        <label for="bio">Brief Biography</label>
        <textarea class="form-control"
                  id="bio"
                  name="biography"
                  rows="4"
                  aria-describedby="bio-help bio-counter"
                  maxlength="500"></textarea>
        <div class="d-flex justify-content-between">
            <small id="bio-help" class="form-text text-muted">
                Tell us about your background and learning goals.
            </small>
            <small id="bio-counter" class="form-text text-muted" aria-live="polite">
                <span id="char-count">0</span>/500 characters
            </small>
        </div>
    </div>

    <!-- Radio Button Group with Fieldset -->
    <fieldset class="form-group">
        <legend>Preferred Contact Method <span class="text-danger" aria-hidden="true">*</span></legend>
        <div class="form-check">
            <input class="form-check-input"
                   type="radio"
                   name="contact_method"
                   id="contact-email"
                   value="email"
                   required>
            <label class="form-check-label" for="contact-email">
                Email
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input"
                   type="radio"
                   name="contact_method"
                   id="contact-phone"
                   value="phone">
            <label class="form-check-label" for="contact-phone">
                Phone
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input"
                   type="radio"
                   name="contact_method"
                   id="contact-lms"
                   value="lms">
            <label class="form-check-label" for="contact-lms">
                LMS Messaging
            </label>
        </div>
    </fieldset>

    <!-- Checkbox Group with Fieldset -->
    <fieldset class="form-group">
        <legend>Accommodations Needed (select all that apply)</legend>
        <div class="form-check">
            <input class="form-check-input"
                   type="checkbox"
                   id="accom-extended"
                   name="accommodations[]"
                   value="extended_time">
            <label class="form-check-label" for="accom-extended">
                Extended time on assessments
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input"
                   type="checkbox"
                   id="accom-captions"
                   name="accommodations[]"
                   value="captions">
            <label class="form-check-label" for="accom-captions">
                Closed captions for videos
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input"
                   type="checkbox"
                   id="accom-screen-reader"
                   name="accommodations[]"
                   value="screen_reader">
            <label class="form-check-label" for="accom-screen-reader">
                Screen reader compatible materials
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input"
                   type="checkbox"
                   id="accom-other"
                   name="accommodations[]"
                   value="other">
            <label class="form-check-label" for="accom-other">
                Other (please specify in biography)
            </label>
        </div>
    </fieldset>

    <!-- Terms Checkbox -->
    <div class="form-group form-check">
        <input type="checkbox"
               class="form-check-input"
               id="agree-terms"
               name="agree_terms"
               required
               aria-required="true"
               aria-describedby="terms-error">
        <label class="form-check-label" for="agree-terms">
            I agree to the <a href="{{TERMS_LINK}}" target="_blank" rel="noopener">
                course policies and academic integrity guidelines
                <span class="sr-only">(opens in new window)</span>
            </a>
            <span class="text-danger" aria-hidden="true">*</span>
        </label>
        <div id="terms-error" class="invalid-feedback">
            You must agree to the course policies to continue.
        </div>
    </div>

    <!-- Form Actions -->
    <div class="form-group mt-4">
        <button type="submit" class="btn btn-primary">
            Submit Registration
        </button>
        <button type="reset" class="btn btn-outline-secondary ml-2">
            Clear Form
        </button>
    </div>
</form>

<!-- Accessible Form Styles -->
<style>
    /* Required field indicator */
    label .text-danger {
        font-weight: bold;
    }

    /* Enhanced focus indicators */
    .form-control:focus,
    .form-check-input:focus {
        border-color: #2c5aa0;
        box-shadow: 0 0 0 0.2rem rgba(44, 90, 160, 0.25);
        outline: 3px solid #ffc107;
        outline-offset: 2px;
    }

    /* Error state styling */
    .form-control.is-invalid {
        border-color: #dc3545;
        background-image: none;
    }
    .form-control.is-invalid:focus {
        border-color: #dc3545;
        box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
    }

    /* Fieldset styling */
    fieldset {
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 1rem;
        margin-bottom: 1rem;
    }
    legend {
        font-size: 1rem;
        font-weight: 600;
        padding: 0 0.5rem;
        width: auto;
    }

    /* Screen reader only */
    .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
    }

    /* Help text styling */
    .form-text {
        margin-top: 0.25rem;
        font-size: 0.875rem;
    }
</style>

<!-- Form Validation Script -->
<script>
(function() {
    'use strict';

    // Character counter for textarea
    const bio = document.getElementById('bio');
    const charCount = document.getElementById('char-count');

    if (bio && charCount) {
        bio.addEventListener('input', function() {
            charCount.textContent = this.value.length;
        });
    }

    // Form validation
    const form = document.querySelector('form');
    if (form) {
        form.addEventListener('submit', function(event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();

                // Find first invalid field and focus it
                const firstInvalid = form.querySelector(':invalid');
                if (firstInvalid) {
                    firstInvalid.focus();
                    firstInvalid.setAttribute('aria-invalid', 'true');
                }
            }
            form.classList.add('was-validated');
        });
    }
})();
</script>
